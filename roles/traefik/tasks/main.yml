---
# tasks file for maxxberg.traefik

- name: Create docker networks - web_backend
  community.docker.docker_network:
    name: "{{ backend_network }}"
    internal: true
    state: present
  when: container_engine == "docker"

- name: Create docker networks - web_backend
  containers.podman.podman_network:
    name: "{{ backend_network }}"
    internal: true
    state: present
  when: container_engine == "podman"

- name: Create project directotory
  ansible.builtin.file:
    path: docker-compose/traefik
    state: directory
    mode: "0755"

- name: upload config file
  template:
    src: traefik.yaml.j2
    dest: docker-compose/traefik/traefik.yaml

- name: Create docker-compose.yaml
  template:
    src: docker-compose.yaml.j2
    dest: docker-compose/traefik/docker-compose.yaml
    force: yes

- name: Docker - Traefik
  docker_compose:
    project_src: docker-compose/traefik/
    state: present
    pull: true
